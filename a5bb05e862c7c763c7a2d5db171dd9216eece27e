{
  "comments": [
    {
      "key": {
        "uuid": "505f6e27_4a9bd372",
        "filename": "github-oauth/src/main/java/com/googlesource/gerrit/plugins/github/oauth/OAuthProtocol.java",
        "patchSetId": 2
      },
      "lineNbr": 39,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-15T04:23:51Z",
      "side": 1,
      "message": "Already defined on line 64?",
      "range": {
        "startLine": 39,
        "startChar": 2,
        "endLine": 39,
        "endChar": 81
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_c0d97e72",
        "filename": "github-oauth/src/main/java/com/googlesource/gerrit/plugins/github/oauth/OAuthProtocol.java",
        "patchSetId": 2
      },
      "lineNbr": 39,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T07:25:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "505f6e27_4a9bd372",
      "range": {
        "startLine": 39,
        "startChar": 2,
        "endLine": 39,
        "endChar": 81
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "505f6e27_2a909f4a",
        "filename": "github-plugin/pom.xml",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-15T04:23:51Z",
      "side": 1,
      "message": "Wait for 2.10.3?",
      "range": {
        "startLine": 23,
        "startChar": 13,
        "endLine": 23,
        "endChar": 19
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "309bda8e_a1de7e56",
        "filename": "github-plugin/pom.xml",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T07:25:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "505f6e27_2a909f4a",
      "range": {
        "startLine": 23,
        "startChar": 13,
        "endLine": 23,
        "endChar": 19
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "505f6e27_0a95db3a",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 36,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-15T04:23:51Z",
      "side": 1,
      "message": "Mismatch with pom.xml",
      "range": {
        "startLine": 36,
        "startChar": 40,
        "endLine": 36,
        "endChar": 53
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_80f496d2",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 36,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T07:25:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "505f6e27_0a95db3a",
      "range": {
        "startLine": 36,
        "startChar": 40,
        "endLine": 36,
        "endChar": 53
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70471268_834e5e95",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-15T04:23:51Z",
      "side": 1,
      "message": "Every parameter appears on its own line in ctors annotated with @Inject",
      "range": {
        "startLine": 46,
        "startChar": 6,
        "endLine": 46,
        "endChar": 50
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_60f192e0",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T07:25:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "70471268_834e5e95",
      "range": {
        "startLine": 46,
        "startChar": 6,
        "endLine": 46,
        "endChar": 50
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "505f6e27_ea896729",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 74,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-15T04:23:51Z",
      "side": 1,
      "message": "Shoudn\u0027t this be the id?",
      "range": {
        "startLine": 74,
        "startChar": 29,
        "endLine": 74,
        "endChar": 68
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "309bda8e_81f49ad2",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 74,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T07:25:01Z",
      "side": 1,
      "message": "GitHub plugin historically used the HTTP authentication scheme which uses SCHEME_GERRIT + login as external id.\n\nIf I start using another ID people moving from HTTP authentication to GitHub authentication would not be able to reuse the same identity and will be created as new users.\n\nWe would rather need the OAuth extension point to allow to specify additional external ids at login instead of returning a single one in OAuthUserInfo. Should I submit a patch for that? :-)",
      "parentUuid": "505f6e27_ea896729",
      "range": {
        "startLine": 74,
        "startChar": 29,
        "endLine": 74,
        "endChar": 68
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_000be65e",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 74,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-23T08:05:44Z",
      "side": 1,
      "message": "I would prefer to keep the extension point as simple as possible. Can\u0027t that (and other Github-plugin specific logic) be implemented in plugin itself? Another option would provider some migration option (database?) outside the plugin, when one site migrate from HTTP to OAuth extension point. For the new sites, who start using GitHub plugin directly after it moved to using OAuth extension point, this complication is not needed.",
      "parentUuid": "309bda8e_81f49ad2",
      "range": {
        "startLine": 74,
        "startChar": 29,
        "endLine": 74,
        "endChar": 68
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_c014de79",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 74,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T08:30:11Z",
      "side": 1,
      "message": "It is not only related to the GitHub-specific logic but even to a more generic \"multi-OAuth\" authentication.\n\nImagine that you are you with a specific username (e.g. lucamilanesio) but at a specific point in time you are authenticating with GitHub that assigns you ID#1234. If today GitHub is down (or under DDoS that happens unfortunately quite often) you may want to authenticate with BitBucket ... but you are still you and nobody else :-)\n\nIf a OAuth plugin could provide the list of external-ids associated to you (for GitHub could be both the GitHub-UserID and the GitHub-Username) you can then reuse them for associating the same user to other OAuth providers if and when needed.\n\nSomething similar to the hybrid auth you\u0027ve implemented with OpenID / OAuth 2.0 for Google ID.",
      "parentUuid": "10a256bf_000be65e",
      "range": {
        "startLine": 74,
        "startChar": 29,
        "endLine": 74,
        "endChar": 68
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_60fcf2b1",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 74,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T08:47:25Z",
      "side": 1,
      "message": "I tried to create the situation that I was talking about ... even me is me (lucamilanesio) when logging in with OAuth (but a different provider) I got:\n\n[2015-04-23 09:43:20,277] ERROR com.google.gerrit.server.account.AccountManager : Cannot assign user name \"lucamilanesio\" to account 1000001; name already in use.\n\nIt is something we need to think about :-)",
      "parentUuid": "10a256bf_c014de79",
      "range": {
        "startLine": 74,
        "startChar": 29,
        "endLine": 74,
        "endChar": 68
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_80fff6a6",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 74,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-23T08:53:50Z",
      "side": 1,
      "message": "Your use case is valid, but i wonder if extension point must be really extended to achieve that? There is a Gerrit way to solve multi-user identity linking from the UI:\n\n* Login with OAuth identity foo, provider bar\n* Click User \u003d\u003e Settings \u003d\u003e Identity \u003d\u003e Link Another Identity link\n* Select different OAuth provider baz\n* login with identity qux\n* Consent the authentication\n* Done\n\nNow the account qux@baz is linked to foo@bar. So that you can use your primary OAuth provider, and when it is down, you have plan \"B\".\n\nNote that the series that implements this linking feature is still pending for review, for both Hybrid OpenID/OAuth and native OAuth schemes:\n\n* https://gerrit-review.googlesource.com/#/q/status:open+project:gerrit+branch:stable-2.10+topic:oauth-authentication-provider\n* https://gerrit-review.googlesource.com/#/q/status:open+project:gerrit+branch:stable-2.10+topic:hybrid-openid-oauth-authentication-provider",
      "parentUuid": "10a256bf_c014de79",
      "range": {
        "startLine": 74,
        "startChar": 29,
        "endLine": 74,
        "endChar": 68
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_0032c622",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GitHubOAuthServiceProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 74,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T08:58:03Z",
      "side": 1,
      "message": "If you *could* even login with the second OAuth provider then you would be able to add another external-id and then to switch between them :-)\n\nUnfortunately the login with the second OAuth provider fails because the username already exists.\n\nPossibly the issue is fixed in one of the two changes you mentioned, just added myself as reviewer and will have a look at them now :-)",
      "parentUuid": "10a256bf_80fff6a6",
      "range": {
        "startLine": 74,
        "startChar": 29,
        "endLine": 74,
        "endChar": 68
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "505f6e27_ca86a317",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GuiceHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 71,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-15T04:23:51Z",
      "side": 1,
      "message": "Add plugin-name as a prefix? Or just use the plugin name? In gerrit-oauth-provider this suffix is used, but there we have two OAuth providers: Google \u0026 GitHub.",
      "range": {
        "startLine": 71,
        "startChar": 22,
        "endLine": 71,
        "endChar": 37
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "309bda8e_41ee9204",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GuiceHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 71,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T07:25:01Z",
      "side": 1,
      "message": "OMG ... I just realised that the OAuth extension doesn\u0027t allow to have two plugins to register as OAuth provider?\n\n  private void pickSSOServiceProvider()\n      throws ServletException {\n    SortedSet\u003cString\u003e plugins \u003d oauthServiceProviders.plugins();\n    if (plugins.isEmpty()) {\n      throw new ServletException(\n          \"OAuth service provider wasn\u0027t installed\");\n    }\n    if (plugins.size() \u003d\u003d 1) {\n      SortedMap\u003cString, Provider\u003cOAuthServiceProvider\u003e\u003e services \u003d\n          oauthServiceProviders.byPlugin(Iterables.getOnlyElement(plugins));\n      if (services.size() \u003d\u003d 1) {\n        ssoProvider \u003d Iterables.getOnlyElement(services.values()).get();\n      }\n    }\n  }\n\nWhy that? It does make sense to have multiple plugins to provide multiple OAuth choices, isn\u0027t it?\n\nIn this case, I agree with you, the exported name has no valid use here, as the GitHub plugin exposes only GitHub authentication :-)",
      "parentUuid": "505f6e27_ca86a317",
      "range": {
        "startLine": 71,
        "startChar": 22,
        "endLine": 71,
        "endChar": 37
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_40ee8e04",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GuiceHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 71,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-23T08:05:44Z",
      "side": 1,
      "message": "I think you have misread the code. The code you quoted takes care of special case: only one OAuth plugin is available (called SSO), in which case the selection form mustn\u0027t be rendered. You can have hundreds OAuth plugins that expose thousands of OAuth providers. The only requirements they must have unique names. Also note, that single plugin can expose different OAuth providers. In fact gerrit-oauth-provider exposes two providers. GitHub and Google. When github-plugin exposes GitHub OAuth provider as well and these plugins deployed on the same site, then the user could pick either from the providers to authenticate against GitHub.\n\nOn the selection page the user would be presented with tree rows:\n\n* gerrit-oauth-provider-github-oauth\n* gerrit-oauth-provider-google-oauth\n* github-plugin-github-oauth",
      "parentUuid": "309bda8e_41ee9204",
      "range": {
        "startLine": 71,
        "startChar": 22,
        "endLine": 71,
        "endChar": 37
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_a019dab1",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GuiceHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 71,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T08:30:11Z",
      "side": 1,
      "message": "Ah, OK that makes sense then. Thank you for clarifying.\nWith regards to your plugin that exposes both Google and GitHub OAuth ... it can become a bit misleading for the user though.\n\nWhy don\u0027t you split the plugin into two separate ones?\nAt the end of the day most of the people would like just to migrate from OpenID to OAuth and keep the Google ID authentication: why should they be bothered about GitHub then?",
      "parentUuid": "10a256bf_40ee8e04",
      "range": {
        "startLine": 71,
        "startChar": 22,
        "endLine": 71,
        "endChar": 37
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "10a256bf_4009ee5d",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GuiceHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 71,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-23T08:53:50Z",
      "side": 1,
      "message": "Well, there are many reasons to keep different providers in one plugin: KISS. Compare it to OpenID for a site with diverse user base:\n\nyou install gerrit.war and it just works. Now your users can connect to Gerrit using different OpenID providers:\n\n* Launchpad\n* Fedoraproject\n* Google\n* Yahoo!\n* ...\n\nWhy unnecessary make things complex? Deploy one plugin and you are done, except that the protocol used is OAuth and not OpenID.\n\nGiven how hard to setup Buck and compile a plugin (just check issues on gerrit-provider-plugin GH page) and given that the actual OAuth magic is done in scribe library anyway, and that the plugin specific implementation is less then 40 lines, it\u0027s overkill to provide dedicated OAuth plugin for each provider.",
      "parentUuid": "10a256bf_a019dab1",
      "range": {
        "startLine": 71,
        "startChar": 22,
        "endLine": 71,
        "endChar": 37
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "309bda8e_e136c614",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/GuiceHttpModule.java",
        "patchSetId": 2
      },
      "lineNbr": 71,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T10:28:11Z",
      "side": 1,
      "message": "Yes, at the moment you are right :-) but think when the list of providers will grow the project will start to be a \"dumping ground\".\n\nAdditionally, as you said, you typically need only 1 provider.\nIf you then need Google OAuth you install 1 plugin only (exactly as you do now) and if you need GitHub OAuth you install 1 plugin only (exactly as you do now).\n\nDoesn\u0027t seems more complex then to have one plugin per provider, as you would need only one anyway.\n\nP.S. The fact that gerrit.war already includes the OAuth providers ... is it merged? I cannot see the gerrit-oauth-provider in the core plugins :-(",
      "parentUuid": "10a256bf_4009ee5d",
      "range": {
        "startLine": 71,
        "startChar": 22,
        "endLine": 71,
        "endChar": 37
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "505f6e27_aa836f05",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/InitGitHub.java",
        "patchSetId": 2
      },
      "lineNbr": 65,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2015-04-15T04:23:51Z",
      "side": 1,
      "message": "Is this needed? It is only set in another branch of this if?",
      "range": {
        "startLine": 65,
        "startChar": 6,
        "endLine": 65,
        "endChar": 32
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "309bda8e_21eb8ef4",
        "filename": "github-plugin/src/main/java/com/googlesource/gerrit/plugins/github/InitGitHub.java",
        "patchSetId": 2
      },
      "lineNbr": 65,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2015-04-23T07:25:01Z",
      "side": 1,
      "message": "Yes, it is.\n\nImagine that you are switching from GitHub/HTTP to GitHub/OAuth: you have already set the filterClass to the GitHub/OAuth filter and when switching to the native Gerrit/OAuth you DO NEED to remove that filter.",
      "parentUuid": "505f6e27_aa836f05",
      "range": {
        "startLine": 65,
        "startChar": 6,
        "endLine": 65,
        "endChar": 32
      },
      "revId": "a5bb05e862c7c763c7a2d5db171dd9216eece27e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}