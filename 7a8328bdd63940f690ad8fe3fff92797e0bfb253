{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "c2909b4d_f3677f48",
        "filename": "/COMMIT_MSG",
        "patchSetId": 10
      },
      "lineNbr": 21,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2023-08-31T07:58:02Z",
      "side": 1,
      "message": "nit: AFAIU it was always containing `example.com` and it was fine as it didn\u0027t matter to which underlying server user was redirected (if any).\n\nHowever with this change we want to achieve the following scenario:\nif user goes to a specific sub-domain (`eclipse.gerrithub.io`) and logs in it lands back into the server(s) that serve that domain\n\nI would propose to stick to the case that we have IOW `review.gerrithub.io` vs `eclipse.gerrithub.io` so that example is easier to grasp.",
      "range": {
        "startLine": 17,
        "startChar": 28,
        "endLine": 21,
        "endChar": 16
      },
      "revId": "7a8328bdd63940f690ad8fe3fff92797e0bfb253",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6af77df2_fcf4af5a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2023-08-30T14:34:59Z",
      "side": 1,
      "message": "Please, review this change.",
      "revId": "7a8328bdd63940f690ad8fe3fff92797e0bfb253",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8a22f400_5633e335",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2023-08-31T07:58:02Z",
      "side": 1,
      "message": "I would keep that as specific as possible - IOW use the description of the case that we want to solve with this change which AFAIR is `review.gerrithub.io` vs `eclipse.gerrithub.io` in both commit message and documentation as in current form it is a bit blurry to me why do we even care ðŸ˜„. But I will leave it up to you Alvaro if you want to follow that suggestion.\n\nIOW it LGTM (apart from links in docs) @luka WDYT?",
      "revId": "7a8328bdd63940f690ad8fe3fff92797e0bfb253",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1e3daa5a_732c1532",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2023-08-31T10:04:28Z",
      "side": 1,
      "message": "Well, I think you have missed some conversations. The issue `Invalid redirection in multi-site setups in the login flow` [1] is not accurate or valid anymore. we found out that the reason of that issue was because there was a bad configuration in the Github OAuth App [2] regarding the `Authorization callback URL` and its relationship with the query parameter `redirect_uri`. What happened is that the callback was defined as `https://review.gerrithub.io/whatever` and the `redirect_uri` could be defined as `https://eclipse.gerrithub.io/whatever`?. If you go to the documentation [3] it says:\n```\nThe redirect_uri parameter is optional...If provided, the redirect URL\u0027s host\n(excluding sub-domains) and port must exactly match the callback URL. \nThe redirect URL\u0027s path must reference a subdirectory of the callback URL.\n```\nThere is no way that is going to work. Then, if we change the callback to `https://gerrithub.io/whatever`, and you provide as a `redirect_uri` either `https://review.gerrithub.io/whatever` or `https://eclipse.gerrithub.io/whatever` it will work and the issue mentioned above is not valid anymore.\n\nLets now restart the conversation. Given the Github OAuth App is well defined and the relationship between domain and subdomains is correct. IMHO the problem now is a UX problem, why? because before the logic to build the `redirect_uri` query parameter was based on the `canonical web url`, therefore if its value is `review.gerrithub.io` when you are initialing the sign-in flow from `eclipse.gerrithub.io`. the flow ends up in `review.gerrithub.io` which from the UX perspective is not very desirable (there are other problems i.e if review.gerrithub.io is down...). With this change we provide the option to start and end the flow in the same subdomain.domain.\n\nI hope that makes sense.\n\nReferences:\n[1] https://issues.gerritcodereview.com/issues/297231231\n[2] https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/creating-an-oauth-app\n[3] https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/authorizing-oauth-apps#redirect-urls",
      "parentUuid": "8a22f400_5633e335",
      "revId": "7a8328bdd63940f690ad8fe3fff92797e0bfb253",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "32e88fb4_91d4f391",
        "filename": "README.md",
        "patchSetId": 10
      },
      "lineNbr": 200,
      "author": {
        "id": 1025452
      },
      "writtenOn": "2023-08-31T07:58:02Z",
      "side": 1,
      "message": "nit: it is not a commit message hence links can be placed in the source text",
      "range": {
        "startLine": 196,
        "startChar": 0,
        "endLine": 200,
        "endChar": 88
      },
      "revId": "7a8328bdd63940f690ad8fe3fff92797e0bfb253",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8ebd8185_ac66ad6e",
        "filename": "README.md",
        "patchSetId": 10
      },
      "lineNbr": 200,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2023-08-31T09:34:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "32e88fb4_91d4f391",
      "range": {
        "startLine": 196,
        "startChar": 0,
        "endLine": 200,
        "endChar": 88
      },
      "revId": "7a8328bdd63940f690ad8fe3fff92797e0bfb253",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}